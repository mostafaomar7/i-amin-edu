<div class="content-wrapper container-xxl p-0">
  <div class="content-body">
    <!-- Organization List -->
    <section class="organizations-list-wrapper">
      <!-- Card Header -->
      <div class="card pb-3 pr-3 pl-3">
        <h5 class="card-header">{{ 'ORGANIZATION.DETAILS' | translate }}</h5>

        <ul
          ngbNav
          #navJustified="ngbNav"
          class="nav nav-pills nav-justified bg-light-info"
        >
          <!-- Overview -->
          <li ngbNavItem>
            <a ngbNavLink>{{ 'ORGANIZATION.OVERVIEW' | translate }}</a>
            <ng-template ngbNavContent>
              <app-organization-overview
                [selectedCenterId]="centerId"
              ></app-organization-overview>
            </ng-template>
          </li>

          <!-- Courses -->
          <li ngbNavItem>
            <a ngbNavLink>{{ 'ORGANIZATION.COURSES' | translate }}</a>
            <ng-template ngbNavContent>
              <div class="p-3 bg-white rounded shadow-sm mt-3">
                <h4 class="mb-3">{{ 'ORGANIZATION.CoursePurchases' | translate }}</h4>

                <ngx-datatable
                  class="bootstrap"
                  [rows]="courses"
                  [columnMode]="'force'"
                  [headerHeight]="50"
                  [footerHeight]="50"
                  [rowHeight]="'auto'"
                  [limit]="10"
                >
                  <ngx-datatable-column
                    name="{{ 'ORGANIZATION.Student' | translate }}"
                    prop="studentName"
                  ></ngx-datatable-column>

                  <ngx-datatable-column
                    name="{{ 'ORGANIZATION.courseName' | translate }}"
                    prop="courseName"
                  ></ngx-datatable-column>

                  <ngx-datatable-column name="{{ 'ORGANIZATION.Amount' | translate }}">
                    <ng-template let-row="row" ngx-datatable-cell-template>
                      {{ row.amount }} {{ row.currency }}
                    </ng-template>
                  </ngx-datatable-column>

                  <ngx-datatable-column name="{{ 'ORGANIZATION.Date' | translate }}">
                    <ng-template let-row="row" ngx-datatable-cell-template>
                      {{ row.date | date: 'medium' }}
                    </ng-template>
                  </ngx-datatable-column>
                </ngx-datatable>

                <p
                  *ngIf="!courses?.length"
                  class="text-center mt-3 text-muted"
                >
                  {{ 'ORGANIZATION.Nocoursepurchasesfound' | translate }}
                </p>
              </div>
            </ng-template>
          </li>

          <!-- Sessions -->
          <li ngbNavItem>
            <a ngbNavLink>{{ 'ORGANIZATION.SESSIONS' | translate }}</a>
            <ng-template ngbNavContent>
              <div class="p-3 bg-white rounded shadow-sm mt-3">
                <h4 class="mb-3">{{ 'ORGANIZATION.SessionPurchases' | translate }}</h4>

                <ngx-datatable
                  class="bootstrap"
                  [rows]="sessions"
                  [columnMode]="'force'"
                  [headerHeight]="50"
                  [footerHeight]="50"
                  [rowHeight]="'auto'"
                  [limit]="10"
                >
                  <ngx-datatable-column
                    name="{{ 'ORGANIZATION.sessionTitle' | translate }}"
                    prop="sessionTitle"
                  ></ngx-datatable-column>

                  <ngx-datatable-column
                    name="{{ 'ORGANIZATION.Student' | translate }}"
                    prop="studentName"
                  ></ngx-datatable-column>

                  <ngx-datatable-column name="{{ 'ORGANIZATION.Amount' | translate }}">
                    <ng-template let-row="row" ngx-datatable-cell-template>
                      {{ row.amount }} {{ row.currency }}
                    </ng-template>
                  </ngx-datatable-column>

                  <ngx-datatable-column name="{{ 'ORGANIZATION.Date' | translate }}">
                    <ng-template let-row="row" ngx-datatable-cell-template>
                      {{ row.date | date: 'medium' }}
                    </ng-template>
                  </ngx-datatable-column>
                </ngx-datatable>

                <p
                  *ngIf="!sessions?.length"
                  class="text-center mt-3 text-muted"
                >
                  {{ 'ORGANIZATION.Nosessionpurchasesfound' | translate }}
                </p>
              </div>
            </ng-template>
          </li>

          <!-- Instructors -->
          <li ngbNavItem>
            <a ngbNavLink>{{ 'ORGANIZATION.INSTRUCTORS' | translate }}</a>
            <ng-template ngbNavContent>
              <div class="p-3 bg-white rounded shadow-sm mt-3">
                <h4 class="mb-3">{{ 'ORGANIZATION.INSTRUCTORS' | translate }}</h4>

                <ngx-datatable
                  class="bootstrap"
                  [rows]="instructors"
                  [columnMode]="'force'"
                  [headerHeight]="50"
                  [footerHeight]="50"
                  [rowHeight]="'auto'"
                  [limit]="10"
                >
                  <ngx-datatable-column
                    name="{{ 'ORGANIZATION.Name' | translate }}"
                    prop="name"
                  ></ngx-datatable-column>

                  <ngx-datatable-column
                    name="{{ 'PHONE_NUMBER' | translate }}"
                    prop="phone"
                  ></ngx-datatable-column>

                  <ngx-datatable-column
                    name="{{ 'EDUCATIONAL_SUBJECT' | translate }}"
                    prop="subject"
                  ></ngx-datatable-column>

                  <ngx-datatable-column name="{{ 'IMAGE' | translate }}">
                    <ng-template let-row="row" ngx-datatable-cell-template>
                      <img
                        [src]="row.image || 'assets/images/placeholder.jpg'"
                        alt="instructor"
                        width="50"
                        height="50"
                        class="rounded-circle"
                      />
                    </ng-template>
                  </ngx-datatable-column>
                </ngx-datatable>

                <p
                  *ngIf="!instructors?.length"
                  class="text-center mt-3 text-muted"
                >
                  {{ 'ORGANIZATION.Noinstructorsfound' | translate }}
                </p>
              </div>
            </ng-template>
          </li>

          <!-- Payout Requests -->
          <li ngbNavItem>
            <a ngbNavLink>{{ 'ORGANIZATION.PAYOUT_REQUESTS' | translate }}</a>
            <ng-template ngbNavContent>
              <div class="p-3 bg-white rounded shadow-sm mt-4">
                <div
                  class="row d-flex justify-content-between align-items-center mb-3"
                >
                  <h4 class="mb-0 mx-2">{{ 'ORGANIZATION.PAYOUT_REQUESTS' | translate }}</h4>
                  <button
                    class="btn btn-primary mx-2"
                    (click)="toggleRequestInput()"
                  >
                    {{ showRequestInput ? 'Cancel' : 'Add Request' }}
                  </button>
                </div>

                <!-- حقل المبلغ -->
                <div
                  *ngIf="showRequestInput"
                  class="d-flex align-items-center mb-3 px-2"
                >
                  <input
                    type="number"
                    class="form-control w-auto mx-2"
                    placeholder="Enter amount"
                    [(ngModel)]="withdrawAmount"
                  />
                  <button
                    class="btn btn-success"
                    (click)="submitWithdrawRequest()"
                  >
                    Send
                  </button>
                </div>

                <ngx-datatable
                  class="bootstrap"
                  [rows]="payouts"
                  [columnMode]="'force'"
                  [headerHeight]="50"
                  [footerHeight]="50"
                  [rowHeight]="'auto'"
                  [limit]="10"
                >
                  <ngx-datatable-column
                    name="{{ 'ORGANIZATION.Amount' | translate }}"
                    prop="amount"
                    [width]="120"
                  >
                    <ng-template let-row="row" ngx-datatable-cell-template>
                      {{ row.amount }} {{currency}}
                    </ng-template>
                  </ngx-datatable-column>

                  <ngx-datatable-column
                    name="{{ 'STATUS' | translate }}"
                    prop="status"
                    [width]="120"
                  >
                    <ng-template let-row="row" ngx-datatable-cell-template>
                      <span
                        [ngClass]="{
                          'text-warning': row.status === 'Pending',
                          'text-success': row.status === 'Approved',
                          'text-danger': row.status === 'Rejected'
                        }"
                      >
                        {{ row.status }}
                      </span>
                    </ng-template>
                  </ngx-datatable-column>

                  <ngx-datatable-column name="{{ 'ORGANIZATION.BankInfo' | translate }}" [width]="300">
                    <ng-template let-row="row" ngx-datatable-cell-template>
                      <div>
                        <strong>{{ row.bankAccountName }}</strong><br />
                        {{ row.bankName }} - {{ row.bankAccountNumber }}
                      </div>
                    </ng-template>
                  </ngx-datatable-column>

                  <ngx-datatable-column
                    name="{{ 'ORGANIZATION.Date' | translate }}"
                    prop="date"
                    [width]="200"
                  >
                    <ng-template let-row="row" ngx-datatable-cell-template>
                      {{ row.date | date: 'medium' }}
                    </ng-template>
                  </ngx-datatable-column>

                  <ngx-datatable-column name="{{ 'ACTIONS' | translate }}" [width]="200">
                    <ng-template let-row="row" ngx-datatable-cell-template>
                      <button
                        *ngIf="row.status === 'Pending'"
                        class="btn btn-sm btn-outline-success"
                        (click)="activateWithdraw(row)"
                      >
                        {{ 'ORGANIZATION.Approve' | translate }}
                      </button>
                      <button
  *ngIf="row.status?.toLowerCase() === 'rejected'"
  class="btn btn-sm btn-outline-danger mx-1"
  (click)="confirmDelete(row)"
>
  Delete
</button>
                    </ng-template>
                  </ngx-datatable-column>
                </ngx-datatable>
              </div>
            </ng-template>
          </li>
        </ul>
      </div>

      <!-- Loading Spinner -->
      <div *ngIf="isLoading" class="spinner-grow" role="status">
        <span class="sr-only">{{ 'ORGANIZATION.LOADING' | translate }}</span>
      </div>

      <div [ngbNavOutlet]="navJustified" class="mt-1"></div>
    </section>
  </div>
</div>
