<!-- wallet.component.html -->

<div class="wallet-cards" *ngIf="stats">
  <div class="card">
    <h4>{{ 'WALLET.SUCCESSFUL_TRANSACTIONS' | translate }}</h4>
    <p>{{ stats.successfulCount }}</p>
  </div>
  <div class="card">
    <h4>{{ 'WALLET.FAILED_TRANSACTIONS' | translate }}</h4>
    <p>{{ stats.failedCount }}</p>
  </div>
  <div class="card">
    <h4>{{ 'WALLET.COURSES_AMOUNT' | translate }}</h4>
    <p>{{ stats.coursesAmount.toFixed(2) }} EGP</p>
  </div>
  <div class="card">
    <h4>{{ 'WALLET.SESSIONS_AMOUNT' | translate }}</h4>
    <p>{{ stats.sessionsAmount.toFixed(2) }} EGP</p>
  </div>
  <div class="card total">
    <h4>{{ 'WALLET.TOTAL' | translate }}</h4>
    <p>{{ stats.totalAmount.toFixed(2) }} EGP</p>
  </div>
</div>
<div class="wallet-cards" *ngIf="userType==5">
  <div class="card">
    <h4>{{ 'WALLET.SUCCESSFUL_TRANSACTIONS' | translate }}</h4>
    <p>0</p>
  </div>
  <div class="card">
    <h4>{{ 'WALLET.FAILED_TRANSACTIONS' | translate }}</h4>
    <p>0</p>
  </div>
  <div class="card">
    <h4>{{ 'WALLET.COURSES_AMOUNT' | translate }}</h4>
    <p>0 EGP</p>
  </div>
  <div class="card">
    <h4>{{ 'WALLET.SESSIONS_AMOUNT' | translate }}</h4>
    <p>0 EGP</p>
  </div>
  <div class="card total">
    <h4>{{ 'WALLET.TOTAL' | translate }}</h4>
    <p>0 EGP</p>
  </div>
</div>
<!-- Loading for Course Transactions -->
<div *ngIf="isCourseLoading" class="spinner-grow" role="status">
  <span class="sr-only">Loading...</span>
</div>

<div *ngIf="!isCourseLoading">
  <div class="d-flex justify-content-between mb-2">
    <div>
      <label>
        {{ 'WALLET.SHOW' | translate }}
        <select [(ngModel)]="courseSelectedLimit" (change)="onCourseLimitChange()">
          <option [value]="10">10</option>
          <option [value]="25">25</option>
          <option [value]="50">50</option>
        </select>
        {{ 'WALLET.ENTRIES' | translate }}
      </label>
    </div>
    <div>
      <input
        type="search"
        [placeholder]="'WALLET.SEARCH' | translate"
        [(ngModel)]="searchCourse"
        (ngModelChange)="onCourseSearchChange()"
        style="outline: none; border: 1px solid #f1f1f1; padding: 5px;"
      />
    </div>
  </div>

  <h3 style="text-align: left; margin-bottom: 10px;">
    {{ 'WALLET.COURSE_TRANSACTION_WALLET' | translate }}
  </h3>

  <ngx-datatable
    class="bootstrap core-bootstrap"
    [rows]="rows"
    [columnMode]="ColumnMode.force"
    [headerHeight]="50"
    [footerHeight]="50"
    [limit]="courseSelectedLimit"
    [count]="courseTotal"
    [offset]="courseCurrentPage - 1"
    [rowHeight]="50"
    (page)="onCoursePageChange($event)"
  >
    <ngx-datatable-column [name]="'#'" [width]="40">
      <ng-template let-rowIndex="rowIndex" ngx-datatable-cell-template>
        {{ rowIndex + 1 + (courseCurrentPage - 1) * courseSelectedLimit }}
      </ng-template>
    </ngx-datatable-column>

    <ngx-datatable-column [name]="'WALLET.IMAGE' | translate">
      <ng-template let-row="row" ngx-datatable-cell-template>
        <img [src]="row.studentcourse?.course?.coverImage" alt="" style="width: 50px; height: auto;" />
      </ng-template>
    </ngx-datatable-column>

    <ngx-datatable-column [name]="'WALLET.COURSE_NAME' | translate">
      <ng-template let-row="row" ngx-datatable-cell-template>
        {{ row.studentcourse?.course?.nameEn }}
      </ng-template>
    </ngx-datatable-column>

    <ngx-datatable-column [name]="'WALLET.STUDENT_NAME' | translate">
      <ng-template let-row="row" ngx-datatable-cell-template>
        {{ row.studentcourse?.student?.user?.firstName }} {{ row.studentcourse?.student?.user?.lastName }}
      </ng-template>
    </ngx-datatable-column>

    <ngx-datatable-column [name]="'WALLET.AMOUNT' | translate" prop="amount"></ngx-datatable-column>

    <ngx-datatable-column [name]="'WALLET.STATUS' | translate">
      <ng-template let-row="row" ngx-datatable-cell-template>
        {{ row.transactinStatus === 2 ? ('WALLET.SUCCESS' | translate) : ('WALLET.FAILED' | translate) }}
      </ng-template>
    </ngx-datatable-column>

    <ngx-datatable-column [name]="'WALLET.CREATED_AT' | translate">
      <ng-template let-row="row" ngx-datatable-cell-template>
        {{ row.createdAt | date: 'medium' }}
      </ng-template>
    </ngx-datatable-column>
  </ngx-datatable>
</div>

<!-- Loading for Session Bookings -->
<div *ngIf="isSessionLoading" class="spinner-grow" role="status" style="margin-top: 40px;">
  <span class="sr-only">Loading...</span>
</div>

<div *ngIf="!isSessionLoading" style="margin-top: 40px;">
  <div class="d-flex justify-content-between mb-2">
    <div>
      <label>
        {{ 'WALLET.SHOW' | translate }}
        <select [(ngModel)]="sessionSelectedLimit" (change)="onSessionLimitChange()">
          <option [value]="10">10</option>
          <option [value]="25">25</option>
          <option [value]="50">50</option>
        </select>
        {{ 'WALLET.ENTRIES' | translate }}
      </label>
    </div>
    <div>
      <input
        type="text"
        [placeholder]="'WALLET.SEARCH_STUDENT' | translate"
        [(ngModel)]="searchSession"
        (ngModelChange)="onSessionSearchChange()"
        style="padding: 5px; border: 1px solid #ccc;"
      />
    </div>
  </div>

  <h3 style="text-align: left;">
    {{ 'WALLET.SESSION_BOOKING_WALLET' | translate }}
  </h3>

  <ngx-datatable
    class="bootstrap core-bootstrap"
    [rows]="sessionRows"
    [columnMode]="ColumnMode.force"
    [headerHeight]="50"
    [footerHeight]="50"
    [limit]="sessionSelectedLimit"
    [count]="sessionTotal"
    [offset]="sessionCurrentPage - 1"
    [rowHeight]="50"
    (page)="onSessionPageChange($event)"
  >
    <ngx-datatable-column [name]="'#'">
      <ng-template let-rowIndex="rowIndex" ngx-datatable-cell-template>
        {{ rowIndex + 1 + (sessionCurrentPage - 1) * sessionSelectedLimit }}
      </ng-template>
    </ngx-datatable-column>

    <ngx-datatable-column [name]="'WALLET.STUDENT_NAME' | translate">
      <ng-template let-row="row" ngx-datatable-cell-template>
        {{ row.studentName }}
      </ng-template>
    </ngx-datatable-column>

    <!-- <ngx-datatable-column [name]="'WALLET.CONSULTING_TYPE' | translate">
      <ng-template let-row="row" ngx-datatable-cell-template>
        {{ row.consultingType }}
      </ng-template>
    </ngx-datatable-column> -->

    <ngx-datatable-column [name]="'WALLET.DATE_TIME' | translate">
      <ng-template let-row="row" ngx-datatable-cell-template>
            <span [title]="row.dateTime | date: 'medium'">
              {{ ( row.dateTime | date: 'medium' )?.length > 10 ? (( row.dateTime | date: 'medium' ).slice(0, 10) + '...') : ( row.dateTime | date: 'medium' ) }}
            </span>
        </ng-template>
    </ngx-datatable-column>

    <ngx-datatable-column [name]="'WALLET.CONSULTATION_TITLE' | translate">
          <ng-template let-row="row" ngx-datatable-cell-template>
            <span [title]="row.title">
              {{ row.title?.length > 10 ? (row.title.slice(0, 10) + '...') : row.title }}
            </span>
          </ng-template>
    </ngx-datatable-column>

    <ngx-datatable-column [name]="'WALLET.CONSULTATION_DETAILS' | translate">
      <ng-template let-row="row" ngx-datatable-cell-template>
        <span [title]="row.details">
          {{ row.details?.length > 10 ? (row.details.slice(0, 10) + '...') : row.details }}
        </span>
      </ng-template>
</ngx-datatable-column>


    <ngx-datatable-column [name]="'WALLET.AMOUNT_AFTER_DISCOUNT' | translate">
      <ng-template let-row="row" ngx-datatable-cell-template>
        {{ row.amount }} EGP
      </ng-template>
    </ngx-datatable-column>

    <ngx-datatable-column [name]="'WALLET.SDK_LINK' | translate">
      <ng-template let-row="row" ngx-datatable-cell-template>
        <a [href]="'https://zegocloud.com/sdk/' + row.roomId" target="_blank"><button class="btn btn-primary">Session Link</button></a>
      </ng-template>
    </ngx-datatable-column>

    <ngx-datatable-column [name]="'WALLET.TRANSACTION_STATUS' | translate">
      <ng-template let-row="row" ngx-datatable-cell-template>
        {{ row.transactionStatus }}
      </ng-template>
    </ngx-datatable-column>


  </ngx-datatable>
</div>
